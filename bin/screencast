#!/bin/bash

stop_recording()
{
  kill -15 $(pidof ffmpeg) && rm /tmp/recording
}

start_recording()
{
  touch /tmp/recording && ffmpeg -probesize 30M \
    -f x11grab -s 1920x1080 -r 10 \
    -thread_queue_size 64000 -draw_mouse 0 -i :0.0 \
    -f alsa -ac 2  -thread_queue_size 32000 \
    -guess_layout_max 0 -i hw:0 \
    -acodec libvorbis -qscale:a 5 \
    -vcodec theora -qscale:v 8 \
    -loglevel warning ~/screencast_$(date +%s).ogv &
}

main()
{
  if [ -f /tmp/recording ]; then
    stop_recording
  else
    start_recording
  fi
}

main
