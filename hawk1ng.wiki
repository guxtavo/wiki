	###############
	# description #
	###############

  hawk1ng - rtl-sdr router

  administration - ssh, dhcp, hostapd, iptables
                   soon - rtl-sdr suite
                   soon - apache

	########
	# TODO #
	########

  * Block port 22 on eth0 (only allow in the wlan0)
  * Finish scripting the appliance_creation
  * test appliance creation on new sd card (chroot)
  * connect battery - request downtime :)
  * setup suse vpn
  * port tmux status-right
  * clone git repos
  * create mrt graphs (snmp? )
  * set time correctly
  * Integrate OpenSUPPORT
  * Integrate WoK
  * 5V 2A usb

Pi 3 Leds

ACT   green   card status   flashing during SD card activity 
PWR   red     power         power good indicator that goes off when power 
                            drops below 4.65V 

My current battery pack does not work charging and discharging at the same time.

	######################
	# appliance creation #
	######################

https://medium.com/@edoardo849/turn-a-raspberrypi-3-into-a-wifi-router-hotspot-41b03500080e

sudo dd bs=4M if=2017-11-29-raspbian-stretch-lite.img \
  of=/dev/mmcblk0 status=progress conv=fsync

sudo touch /run/media/gfigueira/boot/ssh

apt-get update; apt-get -y upgrade ; apt-get -y install isc-dhcp-server hostapd

cat <<EOF >> /etc/dhcp/dhcpd.conf
subnet 192.168.10.0 netmask 255.255.255.0 {
 range 192.168.10.10 192.168.10.20;
 option broadcast-address 192.168.10.255;
 option routers 192.168.10.1;
 default-lease-time 600;
 max-lease-time 7200;
 option domain-name "local-network";
 option domain-name-servers 8.8.8.8, 8.8.4.4;
}
EOF

vi /etc/default/isc-dhcp-server
INTERFACES="wlan0"

ifdown wlan0
cat <<EOF >> /etc/network/interfaces
auto lo

iface lo inet loopback
iface eth0 inet dhcp

allow-hotplug wlan0

iface wlan0 inet static
  address 192.168.10.1
  netmask 255.255.255.0
  post-up iw dev $IFACE set power_save off
EOF

ifconfig wlan0 192.168.42.1

cat <<EOF > /etc/hostapd/hostapd.conf
interface=wlan0
ssid=hawk1ng
hw_mode=g
channel=1
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=0030mbps
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
EOF


echo 1 > /proc/sys/net/ipv4/ip_forward
net.ipv4.ip_forward=1

cat <<EOF > /etc/iptables.ipv4.nat
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
EOF

sudo service isc-dhcp-server start
sudo service hostapd start

sudo update-rc.d hostapd enable 
sudo update-rc.d isc-dhcp-server enable

sudo sh -c "iptables-save > /etc/iptables.ipv4.nat"

Add the following to the end of the file /etc/network/interfaces to restore the configuration when the network interface comes up:

up iptables-restore < /etc/iptables.ipv4.nat
